---
Permalink: query-filter
---

# Query Filter

## Description

In almost every application, there are some tables which contains inactive or soft deleted data. This kind of data should not be shown to the client or used anymore every time we query these tables, we must remove them with a WHERE clause. Major ORM like NHibernate have a filter feature to select records based on a predefined filter but, unfortunately for Entity Framework users, Query Filter is only available through third party library.

**EF+ Query Filter** lets you change the predefined query from the context generated by Entity Framework for your own Query.

 - You can filter the query with a predicate to exclude soft deleted records:

{% include template-example.html %} 
```csharp

// using Z.EntityFramework.Plus; // Don't forget to include this.
var ctx = new EntitiesContext();

ctx.Filter<Post>(q => q.Where(x => !x.IsSoftDeleted));

// SELECT * FROM Post WHERE IsSoftDeleted = false
var list = ctx.Posts.ToList();

```

[Try it](https://dotnetfiddle.net/066xSv)

 - You can control the default query to add a default sorting:

{% include template-example.html %} 
```csharp

// using Z.EntityFramework.Plus; // Don't forget to include this.
var ctx = new EntitiesContext();

ctx.Filter<Post>(q => q.Where(x => !x.IsSoftDeleted)
                       .OrderByDescending(x => x.ViewCount));

// SELECT * FROM Post WHERE IsSoftDeleted = false ORDER BY ViewCount
var list = ctx.Posts.ToList();

```

[Try it](https://dotnetfiddle.net/F7mGZM)

 - You can use a predefined filter and enable it only for a specific query:

{% include template-example.html %} 
```csharp

// using Z.EntityFramework.Plus; // Don't forget to include this.
var ctx = new EntitiesContext();

ctx.Filter<Post>(MyEnum.EnumValue, q => q.Where(x => !x.IsSoftDeleted)).Disable();

// SELECT * FROM Post WHERE IsSoftDeleted = false
var list = ctx.Posts.Filter(MyEnum.EnumValue).ToList();
```

[Try it](https://dotnetfiddle.net/5bmB2n)

## Options

 - [Global](options/ef6-query-filter-global.md)
 - [By Instance](options/ef6-query-filter-by-instance.md)
 - [By Query](options/ef6-query-filter-by-query.md)
 - [By Inheritance/Interface](options/ef6-query-filter-by-inheritance-interface.md)
 - [By Enable/Disable](options/ef6-query-filter-by-enable-disable.md)
 - [By AsNoFilter](options/ef6-query-filter-by-as-no-filter.md)

## Real Life Scenarios

 - [Logical Data Partitioning](scenarios/ef6-query-filter-logical-data-partitioning.md)
 - [Multi-Tenancy](scenarios/ef6-query-filter-multi-tenancy.md)
 - [Object State](scenarios/ef6-query-filter-object-state.md)
 - [Security Access](scenarios/ef6-query-filter-security-access.md)
 - [Default Ordering](scenarios/ef6-query-filter-default-ordering.md)

## Limitations

 - Entity Framework 5
   - Doesn't work with LazyLoading
   - Doesn't work with Include

### Entity Framework 6 - Limitations
 
#### Property Filter

To some backward compatibility, filtering works already on collection but are not enabled on a property by default.

You must enable the option **AllowPropertyFilter**

{% include template-example.html %} 
```csharp

QueryFilterManager.AllowPropertyFilter = true;

using (var ctx = new EntityContext())
{
    ctx.Filter<Invoice>(q => q.Where(x => !x.IsDeleted));
    ctx.Filter<InvoiceItem>(q => q.Where(x => !x.IsDeleted));

    var list = ctx.InvoiceItems.Where(x => x.Invoice.Total > 400).Include("Invoice").ToList();
}

```

#### Context Filter

Since the QueryCacheManager is global, our library have some limitations with Filter by context (Global Filter doesn't have this issue since it applies the same logic to all query.)

 - LazyLoading only work with GlobalFilter
 - context.Set only work with GlobalFilter (You can use the method SetFiltered instead)

{% include template-example.html %} 
```csharp

var ctx = new EntitiesContext();

ctx.Filter<Post>(q => q.Where(x => !x.IsSoftDeleted)
                       .OrderByDescending(x => x.ViewCount));

// SELECT * FROM Post WHERE IsSoftDeleted = false ORDER BY ViewCount
var list = ctx.SetFiltered<Post>().ToList();

```

[Try it](https://dotnetfiddle.net/cTEtCX)

For this kind of scenario, we recommend using instead: [EntityFramework.DynamicFilters](https://github.com/zzzprojects/EntityFramework.DynamicFilters).

## Conclusion

**EF+ Query Filter** is very powerful and very easy to use. Our filter version covers all kinds of requirements an application could have.

Need help getting started? [info@zzzprojects.com](mailto:info@zzzprojects.com)

We welcome all comments, ideas and suggestions to improve our library.
